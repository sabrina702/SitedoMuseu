<?php
session_start();

// Função para limpar o input (prevenir XSS)
function limpar_input($data) {
    return htmlspecialchars(trim($data));
}

// Inicializa um array para armazenar erros
$erros = [];

// Verifica se o formulário foi enviado
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Valida Nome do Responsável
    if (empty($_POST['nome_responsavel'])) {
        $erros['nome_responsavel'] = "O nome do responsável é obrigatório.";
    }

    // Valida Nome da Escola
    if (empty($_POST['nome_escola'])) {
        $erros['nome_escola'] = "O nome da escola é obrigatório.";
    }

    // Valida Dia Pretendido
    if (empty($_POST['dia_pretendido'])) {
        $erros['dia_pretendido'] = "O dia pretendido é obrigatório.";
    }

    // Valida Horário
    if (empty($_POST['horario'])) {
        $erros['horario'] = "O horário é obrigatório.";
    }

    // Valida Número de Visitantes
    if (empty($_POST['n_visitante']) || !is_numeric($_POST['n_visitante'])) {
        $erros['n_visitante'] = "O número de visitantes deve ser um número válido.";
    }

    // Valida Telefone
    if (empty($_POST['telefone'])) {
        $erros['telefone'] = "O telefone é obrigatório.";
    }

    // Valida Email
    if (empty($_POST['email']) || !filter_var($_POST['email'], FILTER_VALIDATE_EMAIL)) {
        $erros['email'] = "O email deve ser válido.";
    }

    // Valida Faixa Etária
    if (empty($_POST['faixa_etaria'])) {
        $erros['faixa_etaria'] = "A faixa etária dos visitantes é obrigatória.";
    }

    // Se houver erros, armazena-os na sessão e redireciona de volta para o formulário
    if (count($erros) > 0) {
        $_SESSION['erros'] = $erros;
        header("Location: agendamento.php"); // Redireciona para o formulário
        exit();
    } else {
        // Se não houver erros, pode prosseguir com o envio (ex: salvar no banco de dados)
        // Redireciona ou faz algo após a validação com sucesso
        unset($_SESSION['erros']); // Limpa os erros após o sucesso
        // Você pode fazer algo aqui, como salvar no banco
    }
}
?>
